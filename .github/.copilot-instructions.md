# 🤖 Instructions Copilot - Java Cine API

## 🎯 CONTEXTE DU PROJET

**API Spring Boot** pour gestion de films et séries avec intégration TMDB.

### Stack technique :
- **Backend** : Spring Boot + Java 17 + Gradle + JPA/Hibernate + PostgreSQL
- **APIs externes** : TMDB
- **Base de données** : PostgreSQL avec entités Movie/Serie
- **Dev server** : `./gradlew bootRun` sur port 8080
- **Hot reload** : Spring Boot DevTools activé

---

## 📋 RÈGLES DE REFACTORING

### ✅ **Autorisé sans confirmation :**
- Amélioration du code existant (clean code, performance)
- Ajout de commentaires et documentation
- Restructuration des packages
- Optimisation des imports
- Amélioration des annotations Spring
- Mise à jour des DTOs et validations
- Amélioration de la gestion des exceptions
- Lancer le serveur de développement pour tester les changements

### ⚠️ **Interdictions strictes :**
- **NE PAS modifier les fonctionnalités existantes**
- **NE PAS changer les endpoints API**
- **NE PAS modifier les entités JPA sans accord**
- **NE PAS changer la structure des réponses JSON**

---

## 🚀 RÈGLES D'EXÉCUTION DES COMMANDES

- ✅ Ne pas attendre d'appui sur "Continuer" pour les lignes de commande
- ✅ Enchaîner les commandes nécessaires pour accomplir la tâche
- ✅ Utiliser `./gradlew` (wrapper) au lieu de `gradle`

### **Exceptions nécessitant confirmation** :
- ⚠️ Suppression de fichiers importants
- ⚠️ Modification de configuration système
- ⚠️ Ajout de nouvelles dépendances dans build.gradle
- ⚠️ Changements irréversibles

---

## 📁 STRUCTURE PROJET JAVA

```
src/main/java/com/example/java_cine_api/
├── JavaCineApiApplication.java    # Main Spring Boot
├── controller/                    # Contrôleurs REST
│   ├── HelloController.java      # Endpoint global /api
│   ├── MovieController.java      # CRUD films
│   └── SerieController.java      # CRUD séries
├── service/                       # Services métier
│   ├── MovieService.java
│   ├── SerieService.java
│   └── TMDBService.java          # Service TMDB externe
├── entity/                        # Entités JPA
│   ├── Movie.java
│   └── Serie.java
├── dto/                          # DTOs et réponses
│   ├── TMDBMovieResponse.java
│   └── TMDBSearchResponse.java
└── repository/                   # Repositories JPA
    ├── MovieRepository.java
    └── SerieRepository.java

src/main/resources/
├── application.properties        # Configuration Spring
└── application-dev.properties    # Configuration développement
```

---

## 🎨 BONNES PRATIQUES JAVA/SPRING

### **Code Quality :**
- Utiliser les annotations Spring appropriées (@RestController, @Service, @Repository)
- Validation avec @Valid et annotations Jakarta Validation
- Gestion d'erreurs avec @ControllerAdvice
- Commentaires en français pour la logique métier
- Respecter les conventions de nommage Java

### **API Design :**
- Préfixe `/api` pour toutes les routes
- Respecter les conventions REST
- Réponses JSON cohérentes avec ResponseEntity<>
- Gestion d'erreurs unifiée
- Documentation des endpoints

### **Base de données :**
- Utiliser JPA/Hibernate pour toutes les requêtes
- Annotations @Entity, @Table, @Column appropriées
- Gérer les relations avec @OneToMany, @ManyToOne
- Optimiser les requêtes (fetch strategies)

---

## 🔑 ENDPOINTS ACTUELS

### **Global**
- `GET /` - Message de bienvenue
- `GET /search?q=<query>&limit=<number>` - Recherche globale films/séries

### **Films (/movie)**
- `GET /movie` - Liste tous les films
- `GET /movie/wishlist` - Films en wishlist
- `GET /movie/rated` - Films notés
- `GET /movie/search?q=<query>&limit=<number>` - Recherche films
- `GET /movie/tmdb/:tmdbId` - Détails TMDB d'un film
- `GET /movie/:id` - Détails d'un film par ID local
- `POST /movie` - Créer un film
- `POST /movie/tmdb` - Créer/mettre à jour depuis TMDB
- `PUT /movie/:id` - Modifier un film
- `DELETE /movie/:id` - Supprimer un film

### **Séries (/serie)**
- `GET /serie` - Liste toutes les séries
- `GET /serie/wishlist` - Séries en wishlist
- `GET /serie/rated` - Séries notées
- `GET /serie/search?q=<query>&limit=<number>` - Recherche séries
- `GET /serie/tmdb/:tmdbId` - Détails TMDB d'une série
- `GET /serie/:id` - Détails d'une série par ID local
- `POST /serie` - Créer une série
- `POST /serie/tmdb` - Créer/mettre à jour depuis TMDB
- `PUT /serie/:id` - Modifier une série
- `DELETE /serie/:id` - Supprimer une série


---

## 🛠️ COMMANDES GRADLE ESSENTIELLES

```bash
# Lancement serveur développement
./gradlew bootRun

# Build du projet
./gradlew build

# Build propre
./gradlew clean build

# Tests
./gradlew test

# Voir les tâches disponibles
./gradlew tasks
```

---

## 🔧 GESTION DES DÉPENDANCES

### **Dépendances actuelles (build.gradle) :**
```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    
    // À ajouter selon besoins :
    // implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    // implementation 'org.postgresql:postgresql'
    // implementation 'org.springframework.boot:spring-boot-starter-validation'
}
```

---

**Objectif :** Code Java propre, maintenable et performant avec Spring Boot tout en préservant les fonctionnalités existantes.
