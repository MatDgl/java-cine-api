# Java Cine API 🎬

API Spring Boot pour la gestion de films et séries avec intégration TMDB (The Movie Database).

Cette API est la version Java/Spring Boot de l'API NestJS originale, offrant les mêmes fonctionnalités avec une architecture Spring Boot bien structurée.

## 🚀 Fonctionnalités

### Films
- ✅ CRUD complet des films locaux
- ✅ Création de films depuis TMDB ID
- ✅ Gestion wishlist et notes
- ✅ Recherche avec données TMDB enrichies
- ✅ Enrichissement automatique des posters

### Séries
- ✅ CRUD complet des séries locales
- ✅ Création de séries depuis TMDB ID
- ✅ Gestion wishlist et notes
- ✅ Recherche avec données TMDB enrichies
- ✅ Enrichissement automatique des posters

### TMDB Integration
- ✅ Recherche films/séries
- ✅ Détails complets avec crédits
- ✅ Recherche multi (films + séries)
- ✅ Gestion asynchrone pour les performances

## 🏗️ Architecture

```
src/main/java/com/example/java_cine_api/
├── controller/          # Contrôleurs REST
│   ├── AppController.java
│   ├── MovieController.java
│   └── SerieController.java
├── service/             # Logique métier
│   ├── TmdbService.java
│   ├── MovieService.java
│   └── SerieService.java
├── repository/          # Accès aux données JPA
│   ├── MovieRepository.java
│   └── SerieRepository.java
├── entity/              # Entités JPA
│   ├── Movie.java
│   └── Serie.java
├── dto/                 # Data Transfer Objects
│   ├── movie/
│   ├── serie/
│   └── tmdb/
├── config/              # Configuration Spring
│   ├── ApplicationConfig.java
│   └── JacksonConfig.java
└── exception/           # Gestion d'erreurs
    ├── GlobalExceptionHandler.java
    ├── ResourceNotFoundException.java
    └── TmdbApiException.java
```

## 🗄️ Base de données

```sql
-- Table Movie
CREATE TABLE movie (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR(255) NOT NULL,
    tmdb_id INTEGER UNIQUE,
    rating NUMERIC(3,1) CHECK (rating >= 0 AND rating <= 10),
    wishlist BOOLEAN DEFAULT FALSE,
    review VARCHAR(1000),
    view_count INTEGER DEFAULT 0,
    watched BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table Serie
CREATE TABLE serie (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR(255) NOT NULL,
    tmdb_id INTEGER UNIQUE,
    rating NUMERIC(3,1) CHECK (rating >= 0 AND rating <= 10),
    wishlist BOOLEAN DEFAULT FALSE,
    review VARCHAR(1000),
    view_count INTEGER DEFAULT 0,
    watched BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 🚀 Démarrage rapide

### Prérequis
- Java 17+
- PostgreSQL
- Token TMDB Bearer

### Configuration

1. **Base de données PostgreSQL** :
```bash
# Créer la base de données
createdb cine
```

2. **Configuration application.properties** :
```properties
# Base de données
spring.datasource.url=jdbc:postgresql://localhost:5432/cine
spring.datasource.username=postgres
spring.datasource.password=your_password

# TMDB API
tmdb.bearer.token=your_tmdb_token
```

3. **Démarrage** :
```bash
./gradlew bootRun
```

L'API sera disponible sur : http://localhost:8080

## 📚 API Endpoints

### Films (`/movie`)

| Méthode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/movie` | Tous les films avec posters |
| GET | `/movie/wishlist` | Films en wishlist |
| GET | `/movie/rated` | Films notés |
| GET | `/movie/search?q=query&limit=20` | Recherche TMDB + statut local |
| GET | `/movie/tmdb/{tmdbId}` | Détails TMDB + statut local |
| GET | `/movie/{id}` | Film local par ID |
| POST | `/movie` | Créer film manuel |
| POST | `/movie/tmdb` | Créer film depuis TMDB |
| PUT | `/movie/{id}` | Modifier film |
| DELETE | `/movie/{id}` | Supprimer film |

### Séries (`/serie`)

| Méthode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/serie` | Toutes les séries avec posters |
| GET | `/serie/wishlist` | Séries en wishlist |
| GET | `/serie/rated` | Séries notées |
| GET | `/serie/search?q=query&limit=20` | Recherche TMDB + statut local |
| GET | `/serie/tmdb/{tmdbId}` | Détails TMDB + statut local |
| GET | `/serie/{id}` | Série locale par ID |
| POST | `/serie` | Créer série manuelle |
| POST | `/serie/tmdb` | Créer série depuis TMDB |
| PUT | `/serie/{id}` | Modifier série |
| DELETE | `/serie/{id}` | Supprimer série |

### Général

| Méthode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/` | Info API |
| GET | `/health` | Santé API |
| GET | `/search?q=query` | Recherche multi TMDB |

## 🎯 Exemples d'utilisation

### Créer un film depuis TMDB
```bash
curl -X POST http://localhost:8080/movie/tmdb \
  -H "Content-Type: application/json" \
  -d '{
    "tmdbId": 550,
    "rating": 9.5,
    "wishlist": true,
    "review": "Chef-d'\''oeuvre absolu!"
  }'
```

### Rechercher des films
```bash
curl "http://localhost:8080/movie/search?q=fight+club&limit=10"
```

### Récupérer tous les films
```bash
curl http://localhost:8080/movie
```

## 🔧 Configuration avancée

### Profils Spring
- `default` : Production
- `dev` : Développement avec logs détaillés

```bash
./gradlew bootRun --args='--spring.profiles.active=dev'
```

### Variables d'environnement
```bash
export DATABASE_URL=jdbc:postgresql://localhost:5432/cine
export TMDB_BEARER_TOKEN=your_token
export SPRING_PROFILES_ACTIVE=dev
```

## 🧪 Tests

```bash
# Tests unitaires
./gradlew test

# Tests avec couverture
./gradlew test jacocoTestReport
```

## 🏗️ Build et déploiement

```bash
# Build JAR
./gradlew build

# Exécuter le JAR
java -jar build/libs/java-cine-api-0.0.1-SNAPSHOT.jar
```

## 📦 Migration depuis NestJS

Cette API Java reproduit fidèlement l'API NestJS originale :

- ✅ Mêmes endpoints et structure de réponse
- ✅ Même logique métier et validation
- ✅ Compatible avec le frontend Next.js existant
- ✅ Architecture Spring Boot optimisée
- ✅ Gestion d'erreurs robuste
- ✅ Performances améliorées avec requêtes asynchrones

## 🤝 Contribution

1. Fork le projet
2. Créer une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit (`git commit -m 'Add some AmazingFeature'`)
4. Push (`git push origin feature/AmazingFeature`)
5. Créer une Pull Request

## 📄 Licence

Distribué sous licence MIT. Voir `LICENSE` pour plus d'informations.
